# Backend API - 3-слойная архитектура

Это приложение реализует 3-слойную архитектуру на Go с использованием PostgreSQL.

## Архитектура

### Слои приложения:

1. **API слой** (`internal/api/`) - обработка HTTP запросов, валидация входных данных
2. **Business слой** (`internal/business/`) - бизнес-логика приложения
3. **Repository слой** (`internal/repository/`) - работа с базой данных

### Структура проекта:

```
backend/
├── cmd/
│   ├── api/main.go          # Точка входа приложения
│   └── migrate/main.go      # Команды для управления БД
├── internal/
│   ├── api/                 # API слой (контроллеры)
│   ├── business/            # Бизнес слой (сервисы)
│   ├── repository/          # Слой репозитория (работа с БД)
│   ├── models/              # Модели данных
│   ├── config/              # Конфигурация
│   └── database/            # Подключение к БД
├── Dockerfile
├── Makefile
└── go.mod
```

## Быстрый старт

### 1. Запуск через Docker Compose

```bash
# Запуск всех сервисов (бэкенд + база данных)
make up

# Просмотр логов
make logs

# Остановка сервисов
make down
```

### 2. Локальная разработка

```bash
# Установка зависимостей
make deps

# Выполнение миграций
make migrate

# Запуск приложения
make run
```

## Команды для работы с базой данных

```bash
# Создание таблиц и выполнение миграций
make migrate

# Удаление всех таблиц
make drop

# Заполнение тестовыми данными
make seed

# Подключение к БД через Docker
make db-connect

# Создание резервной копии
make db-backup

# Восстановление из резервной копии
make db-restore file=backup_file.sql
```

## API Endpoints

### Пользователи

- `POST /api/v1/users` - Создание пользователя
- `GET /api/v1/users` - Список пользователей (с пагинацией)
- `GET /api/v1/users/:id` - Получение пользователя по ID
- `PUT /api/v1/users/:id` - Обновление пользователя
- `DELETE /api/v1/users/:id` - Удаление пользователя

### Примеры запросов

#### Создание пользователя
```bash
curl -X POST http://localhost:8000/api/v1/users \
  -H "Content-Type: application/json" \
  -d '{
    "username": "john_doe",
    "email": "john@example.com",
    "password": "secure123"
  }'
```

#### Получение списка пользователей
```bash
curl "http://localhost:8000/api/v1/users?page=1&page_size=10"
```

## Переменные окружения

Приложение использует следующие переменные окружения:

```bash
# Сервер
SERVER_HOST=0.0.0.0
SERVER_PORT=8000

# База данных
DB_HOST=db
DB_PORT=5432
DB_USER=postgres
DB_PASS=postgres
DB_NAME=postgres
DB_SSLMODE=disable
```

## Полезные команды разработки

```bash
# Форматирование кода
make fmt

# Линтер
make lint

# Тестирование
make test

# Сборка приложения
make build

# Сборка Docker образа
make docker-build
```

## Особенности архитектуры

### Repository слой
- Определяет интерфейсы для работы с данными
- Содержит команды создания/удаления таблиц
- Изолирует логику работы с БД

### Business слой  
- Содержит всю бизнес-логику
- Валидирует данные на уровне бизнес-правил
- Обрабатывает ошибки и преобразует их для API слоя

### API слой
- Обрабатывает HTTP запросы
- Валидирует входящие данные
- Формирует HTTP ответы

Эта архитектура обеспечивает разделение ответственности, легкость тестирования и возможность независимого развития каждого слоя.
